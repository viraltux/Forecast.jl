using Test
using Forecast
import Forecast: fvar

@testset "forecast_ar" begin

    Φ,Σ2,n = .991,1,10
    @test fvar(Φ,Σ2,n) ≈ [1.0, 1.982081, 2.946564090561, 3.8937646086222375, 4.823992240600336, 5.737551123641018, 6.634739945056495, 7.515852039981027, 8.381175487276607, 9.230993203720098]

    Φ,Σ,n = [1],1,10
    @test fvar(Φ,Σ,n) == [1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0]

    Φ,Σ2,n = [.1,.2,.3,.4],1,10
    @test fvar(Φ,Σ2,n) ≈ [1.0, 1.04, 1.1316, 1.298864, 1.33019856, 1.3615617024, 1.3933145784960002, 1.4040935459558401, 1.4127139118868737, 1.4194229251948607]

    Φ,Σ2,n = [.1 .2;.3 .4],[1. 0.; 0. 1.],10
    @test fvar(Φ,Σ2,n) ≈ [1.0 1.0; 1.07 1.22; 1.0899 1.2834; 1.095643 1.301698; 1.09730051 1.30697906; 1.0977788907 1.3085032482; 1.097916958099 1.308943150354; 1.09795680629243 1.30907011230338; 1.0979683070415651 1.3091067553078386; 1.097971626319537 1.309117330994352] 
    
    Φ,Σ2,n = reshape([[.1 .2; .3 .4] [.5 .6; .7 .8]],2,2,2),[.9 .10; .10 .9],10
    @test fvar(Φ,Σ2,n) ≈ [0.9 0.9; 1.581 1.9450000000000003; 2.8317699999999997 3.9654900000000004; 5.1805797 7.751329700000001; 9.596621872999998 14.871394285000001; 17.899307249409997 28.25758853017; 33.509394643980094 53.425379662210105; 62.858305824161896 100.74395295980472; 118.03792053735555 189.70877680891388; 221.78248040624447 356.9737444577623]

        
    # ar(Φ,n)
    Φ,n = .5,n
    Φ,Φ0,x0,n = .1,.2,.3,10
    xar = ar(arsim(Φ,Φ0,x0,n),1)
    fxar = forecast(xar,10)
    @test size(fxar.mean,1) == 10

end
